# 矩阵

有没有可以一次性改变某个物体所有顶点的方式呢？
有，那就是矩阵，magic is coming

1  0  0  0
0  1  0  0
0  0  1  0
0  0  0  1

上面这个是一个单位矩阵（矩阵最基础的知识这里就不说了），我们用这个乘一个顶点(2,1,0)来看看
![](http://jbcdn2.b0.upaiyun.com/2017/01/ce83715ac74b2bec4b644a592b17c26a.png)

并没有什么变化啊！那我们换一个矩阵来看

1  0  0  1
0  1  0  0
0  0  1  0
0  0  0  1

再乘之前那个顶点，发现顶点的x已经变化了！
![4-300x111](http://jbcdn2.b0.upaiyun.com/2017/01/d668efead664c3cab650bbc62fce106b.png)

如果你再多用几个顶点试一下就会发现，无论我们用哪个顶点，都会得到这样的一个x坐标+1这样一个结果
来，回忆一下我们之前的目的，现在是不是有了一种一次性改变顶点位置的方式呢？

 

2/ 矩阵规律介绍
刚刚我们改变了矩阵16个值中的一个，就使得矩阵有改变顶点的能力，我们能否总结一下矩阵各个值的规律呢？当然是可以的，如下图
![](http://jbcdn2.b0.upaiyun.com/2017/01/9e3ab4c97ab277fec307898d3ba759f3.png)
这里红色的x，y，z分别对应三个方向上的偏移

![](http://jbcdn2.b0.upaiyun.com/2017/01/df217bf791fdf74fe41344c5f34bed34.png)
这里蓝色的x，y，z分别对应三个方向上的缩放

然后是经典的围绕各个轴的旋转矩阵(记忆的时候注意围绕y轴旋转时，几个三角函数的符号……)
1、roll,pitch,yaw
![](http://jbcdn2.b0.upaiyun.com/2017/01/67f61f5135c470983a8a36cd342975f2.png)

2、欧拉角这里使用符号  

还有剪切(skew)效果的变换矩阵，这里用个x轴的例子来体现
![](http://jbcdn2.b0.upaiyun.com/2017/01/5c5ea0ba2a1a5da0b42876fc82b63a14.png)

这里都是某一种单一效果的变化矩阵，可以相乘配合使用的，很简单。我们这里重点来找一下规律，似乎所有的操作都是围绕着红框这一块来的
![](http://jbcdn2.b0.upaiyun.com/2017/01/5b7fae9d503c1538fd9845850acd889c.png)
其实也比较好理解，因为矩阵这里每一行对应了个坐标
![](http://jbcdn2.b0.upaiyun.com/2017/01/908b400bbd3488e98fb8860f4bae3ea0.png)

那么问题来了，最下面那行干啥用的？
一个顶点，坐标(x,y,z)，这个是在笛卡尔坐标系中的表示，在3D世界中我们会将其转换为齐次坐标系，也就是变成了(x,y,z,w)，这样的形式(之前那么多图中w=1)
矩阵的最后一行也就代表着齐次坐标，那么齐次坐标有啥作用？很多书上都会说齐次坐标可以区分一个坐标是点还是向量，点的话齐次项是1，向量的话齐次项是0(所以之前图中w=1)
对于webgl中的Matrix来说齐次项有什么用处呢？或者说这个第四行改变了有什么好处呢？一句话概括(敲黑板，划重点)
它可以让物体有透视的效果
举个例子，大名鼎鼎的透视矩阵，如图
![](http://jbcdn2.b0.upaiyun.com/2017/01/2b064fea5077ee499c42175bac25e5b1.png)
在第四行的第三列就有值，而不像之前的是0；还有一个细节就是第四行的第四列是0，而不是之前的1

写到这里的时候我纠结了，要不要详细的把正视和透视投影矩阵推导写一下，但是考虑到篇幅，实在是不好放在这里了，否则这篇文章要太长了，因为后面还有内容
大部分3D程序开发者可能不是很关注透视矩阵(PMatrix)，只是知道有这一回事，用上这个矩阵可以近大远小，然后代码上也就是glMatrix.setPerspective(……)一下就行了
所以决定后面单独再写一篇，专门说下正视透视矩阵的推导、矩阵的优化这些知识
这里就暂且打住，我们先只考虑红框部分的矩阵所带来的变化
![](http://jbcdn2.b0.upaiyun.com/2017/01/5b7fae9d503c1538fd9845850acd889c.png)



#### 坐标系
![](http://jbcdn2.b0.upaiyun.com/2017/01/ccb0a7bdd420871bcda6c8006cdcc328.png)
```
webgl中所说的右手坐标系，其实是一种规范，是希望开发者一起遵循的规范，
但是webgl本身，是不在乎物体是左手坐标系还是右手坐标系的
不应该是“webgl是左手坐标系”，而应该说“webgl的裁剪空间是按照左手坐标系来的”
```
#### 坐标系 转化
```
只需要我们将z轴反转，就可以得到将裁剪空间由左手坐标系转变为右手坐标系了

1  0  0  0
0  1  0  0
0  0  -1  0
0  0  0  1
```